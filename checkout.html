<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>MX3 Coffee Mix Checkout</title>
        <!--Favicon-->
        <link rel="icon" href="./assets/mx3-favicon.ico" type="image/x-icon" />
        <script src="https://cdn.jsdelivr.net/npm/petite-vue" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js" defer></script>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://unpkg.com/@popperjs/core@2" defer></script>
        <script src="https://cdn.jsdelivr.net/npm/meilisearch@0.50.0/dist/umd/index.min.js" defer></script>
        <!-- Meta Pixel Code -->
        <script>
            !function (f, b, e, v, n, t, s) {
                if (f.fbq) return;
                n = f.fbq = function () {
                    n.callMethod ? n.callMethod.apply(n, arguments) : n.queue.push(arguments)
                };
                if (!f._fbq) f._fbq = n;
                n.push = n;
                n.loaded = !0;
                n.version = '2.0';
                n.queue = [];
                t = b.createElement(e);
                t.async = !0;
                t.src = v;
                s = b.getElementsByTagName(e)[0];
                s.parentNode.insertBefore(t, s)
            }(window, document, 'script',
                'https://connect.facebook.net/en_US/fbevents.js');
        </script>
        <style>
            .loader {
                border-top-color: #3498db;
                animation: spin 1s linear infinite;
            }

            @keyframes spin {
                0% {
                    transform: rotate(0deg);
                }

                100% {
                    transform: rotate(360deg);
                }
            }

        </style>
    </head>

    <body class="bg-gray-100 flex flex-col items-center min-h-screen justify-center p-2 pt-10">
        <script>

            // Get URL parameters to determine selected bundle and price
            const urlParams = new URLSearchParams(window.location.search);
            const bundle = urlParams.get('bundle') || '5-boxes';
            const amount = urlParams.get('amount') || 800;

            function debounce(func, wait, immediate = false) {
                let timeout, result;

                const debounced = function (...args) {
                    const context = this;

                    const later = function () {
                        timeout = null;
                        if (!immediate) {
                            result = func.apply(context, args);
                        }
                    };

                    const callNow = immediate && !timeout;

                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);

                    if (callNow) {
                        result = func.apply(context, args);
                    }

                    return result;
                };

                debounced.cancel = function () {
                    clearTimeout(timeout);
                    timeout = null;
                };

                return debounced;
            }

            // Configuration object for form fields
            window.CSFORM_CONFIG = {
                logo: './assets/mx3coffeefront_400x.webp',
                brandName: "MX3 Coffee Mix",
                title: "Complete Your MX3 Coffee Mix Order",
                description: "Start your day right with MX3 Coffee Mix—an easy-to-enjoy, low-acid coffee packed with beneficial nutrients like Vitamin C, Calcium, and Mangosteen.",
                metaPixelId: "9040427422730750",
                conversionApiToken: "EAAgZBZCJBbGTQBOxQDb4cHYqP3P5rctdZB5YYKKHmUF7opXKaGwshnQXDD0twqGgZCVk0vxwv19XbbPOrbZCIHUjgDZCAGaftMZBoleXkdTZACcjV84uabUNG3UJZB3uMZCvMet9UvpKOSwx1Bc8hHuOFzVtaJ3I31t7BcZCexCeoot37VLCmOe3TgP5V80FAAMYQmZANQZDZD",
                thankyouUrl: "./thankyou.html",
                sheet_id: "1K2D1C8fgz2tM6MT5rVisT-8BTeT-Ri6Q7i3Glqiq7Mo",
                sheet_name: "MX3Orders",
                value: amount,
                currency: "PHP",
                requireEmail: false,
                requirePhone: true,
                requirePhoneOtp: true,
                businessName: "MX3 Philippines",
                businessEmail: "support@mx3.ph",
                businessPhone: "639561301775",
                senderId: "MX3",
            }

            // Configuration object for form fields
            window.CSFORM_FORM = [
                {
                    id: "zip-code",
                    type: "text",
                    label: "Zip Code",
                    placeholder: "Please provide your zip code",
                    required: false,
                },
                {
                    id: "payment_method",
                    type: "radio",
                    label: "Payment Method",
                    description: "We use LBC and JnT couriers for delivery",
                    placeholder: "",
                    required: true,
                    options: [
                        {
                            value: "cod",
                            label: "Cash on Delivery"
                        },
                        {
                            value: "cop",
                            label: "Cash on Pick-up"
                        },
                    ],
                    defaultValue: "cod",
                },
                {
                    id: "notes",
                    type: "textarea",
                    label: "Special Instructions (Optional)",
                    placeholder: "Any delivery instructions or preferences",
                    required: false,
                },
            ];

            document.addEventListener("DOMContentLoaded", () => {
                if (!window.CSFORM_CONFIG) {
                    console.error(
                        "CSFORM_CONFIG is not defined. Please define the configuration object before loading the form script."
                    );
                    return;
                }
                if (!window.CSFORM_FORM) {
                    window.CSFORM_FORM = [];
                }
                //Update page title
                document.title = window.CSFORM_CONFIG.title;
                PetiteVue.createApp({
                    // Existing configuration propertiesÃ¢â‚¬Â¦
                    config: {
                        ...window.CSFORM_CONFIG,
                        apiHost: "https://sg-aws.marketingmaster.io/apis_integrations",
                        conversionEndpoint:
                            "https://sg-aws.marketingmaster.io/apis_integrations/cform_handle_conversion_api",
                    },
                    formConfig: [
                        // Optional fields here
                        ...window.CSFORM_FORM,
                    ],
                    // Dynamically generate formData based on the fields configuration
                    formData: {
                        firstName: "",
                        lastName: "",
                        phone: "",
                        email: "",
                        streetAddress: "",
                        barangay: "",
                        city: "",
                        province: "",
                        ...window.CSFORM_FORM.reduce((data, field) => {
                            data[field.id] = "";
                            return data;
                        }, {}),
                        payment_method: "cod",
                    },
                    barangays: [],
                    meiliSearch: null,
                    globalEventId: "",
                    isLoading: false,
                    isConfirmationVisible: false,
                    isValidating: false,
                    submitStatus: "",
                    isPhoneInvalid: false,
                    isEmailInvalid: false,
                    showBarangayDropdown: false,
                    showCityDropdown: false,
                    showProvinceDropdown: false,
                    popperInstance: null,
                    popperCityInstance: null,
                    popperProvinceInstance: null,
                    isBarangaySearchLoading: false,
                    isCitySearchLoading: false,
                    isProvinceSearchLoading: false,
                    cities: [],
                    provinces: [],
                    // OTP-related reactive properties
                    otpDigits: ["", "", "", ""],
                    otpSent: false,
                    otpValidated: false,
                    isOTPLoading: false,
                    otpError: "",
                    otpCacheKey: "",
                    otpValidationToken: "",
                    // New properties for OTP screen and timer
                    showOTPScreen: false,
                    otpCountdown: 300, // 5 minutes in seconds
                    otpInterval: null,
                    agreeToTerms: true,
                    async submitForm() {
                        if (!this.validateForm()) return;
                        const isContactDetailsValid = await this.validateContactDetails();
                        if (!isContactDetailsValid) return;
                        this.isConfirmationVisible = true;
                        await this.reportConversion("AddToCart");
                    },
                    validateForm() {
                        this.isValidating = true;
                        const extreFieldsRequiredFieldErrors = [];
                        for (const field of this.formConfig) {
                            if (field.required && !this.formData[field.id]) {
                                extreFieldsRequiredFieldErrors.push(field.id);
                            }
                        }
                        if (
                            !this.formData.firstName ||
                            !this.formData.lastName ||
                            !this.formData.phone ||
                            !this.formData.email ||
                            extreFieldsRequiredFieldErrors.length > 0
                        ) {
                            alert("Please fill in all required fields.");
                            return false;
                        }
                        this.saveFormInputs();
                        return true;
                    },
                    buildPayload(EventName = "InitiateCheckout") {
                        let fbc = this.getCookie("_fbc");
                        let fbp = this.getCookie("_fbp");

                        if (!fbc) {
                            const fbclid = new URLSearchParams(window.location.search).get(
                                "fbclid"
                            );
                            if (fbclid) {
                                fbc = this.formatFbc(fbclid);
                            }
                        }

                        if (!fbp) {
                            fbp = this.formatFbp();
                        }

                        const hashedFirstName = CryptoJS.SHA256(
                            this.formData.firstName
                        ).toString();
                        const hashedLastName = CryptoJS.SHA256(
                            this.formData.lastName
                        ).toString();
                        const hashedPhone = CryptoJS.SHA256(this.formData.phone).toString();

                        const userData = {
                            fbc,
                            fbp,
                            ph: [hashedPhone],
                            fn: [hashedFirstName],
                            ln: [hashedLastName],
                            client_ip_address: null,
                            client_user_agent: navigator.userAgent,
                        };

                        if (this.formData.city) {
                            const city = this.formData.city
                                .toLowerCase()
                                .replace(/\s/g, "")
                                .replace(/city/i, "");
                            const hashedCity = CryptoJS.SHA256(city).toString();
                            userData.ct = [hashedCity];
                        }

                        if (this.formData.email) {
                            const hashedEmail = CryptoJS.SHA256(
                                this.formData.email
                            ).toString();
                            userData.em = [hashedEmail];
                        }

                        return {
                            event_name: EventName,
                            event_time: Math.floor(Date.now() / 1000),
                            action_source: "website",
                            event_source_url: window.location.href,
                            event_id: this.getEventId(EventName),
                            user_data: userData,
                            custom_data: {
                                currency: this.config.currency,
                                value: parseFloat(this.config.value).toFixed(2),
                            },
                        };
                    },
                    formatFbc(fbclid, domainIndex = 1) {
                        const creationTime = Date.now();
                        return `fb.${domainIndex}.${creationTime}.${fbclid}`;
                    },
                    formatFbp(domainIndex = 1) {
                        const creationTime = Date.now();
                        const randomNumber = Math.floor(Math.random() * 1e10);
                        return `fb.${domainIndex}.${creationTime}.${randomNumber}`;
                    },
                    getCookie(name) {
                        const value = `; ${document.cookie}`;
                        const parts = value.split(`; ${name}=`);
                        if (parts.length === 2) return parts.pop().split(";").shift();
                        return null;
                    },
                    async finalizeSubmission() {
                        this.isLoading = true;
                        await this.reportConversion("InitiateCheckout");
                        await this.reportConversion("CompleteRegistration");
                        await this.reportConversion("Lead");
                        const myHeaders = new Headers();
                        myHeaders.append("Content-Type", "application/json");

                        const allQueryParams = new URLSearchParams(window.location.search);
                        const allQueryParamsJson = {};
                        for (const [key, value] of allQueryParams) {
                            allQueryParamsJson[key] = value;
                        }

                        const raw = JSON.stringify({
                            data: {
                                ...this.formData,
                            },
                            conversionApi: this.buildPayload(),
                            metaPixelId: this.config.metaPixelId,
                            conversionApiToken: this.config.conversionApiToken,
                            params: allQueryParamsJson,
                            verificationToken: this.otpValidationToken,
                            sheet_id: this.config.sheet_id,
                            sheet_name: this.config.sheet_name,
                            businessEmail: this.config.businessEmail,
                            businessPhone: this.config.businessPhone,
                            businessName: this.config.businessName,
                        });

                        const requestOptions = {
                            method: "POST",
                            headers: myHeaders,
                            body: raw,
                            redirect: "follow",
                        };

                        const loader = document.getElementById("loader");
                        loader.style.display = "flex";
                        fetch(this.config.apiHost + "/cform_handle_submit", requestOptions)
                            .then((response) => response.json())
                            .then(async (data) => {
                                console.log(data);
                                console.log("Submitting form:", JSON.parse(raw));
                                if (data.status) {
                                    this.submitStatus = "success";
                                    await this.reportConversion("Purchase");
                                    if (this.config.thankyouUrl) {
                                        window.location.href = this.config.thankyouUrl;
                                    }
                                } else {
                                    this.submitStatus = "failed";
                                }
                                this.saveFormInputs();
                                return data;
                            })
                            .catch((error) => {
                                setTimeout(() => {
                                    loader.style.display = "none";
                                }, 1000);
                                console.error("Error submitting form:", error);
                            })
                            .finally((data) => {
                                this.isLoading = false;
                                setTimeout(() => {
                                    loader.style.display = "none";
                                }, 1000);
                                console.log("Form Submitted", data);
                            });
                    },
                    saveFormInputs() {
                        localStorage.setItem("formData", JSON.stringify(this.formData));
                    },
                    refresh() {
                        window.location.href =
                            window.location.origin + window.location.pathname;
                    },
                    getEventId(eventName) {
                        return eventName.toLowerCase() + this.globalEventId;
                    },
                    reportConversion(eventName = "Purchase") {
                        fbq(
                            "track",
                            eventName,
                            {
                                currency: this.config.currency,
                                value: parseFloat(this.config.value).toFixed(2),
                            },
                            { eventID: this.getEventId(eventName) }
                        );

                        const myHeaders = new Headers();
                        myHeaders.append("Content-Type", "application/json");

                        const allQueryParams = new URLSearchParams(window.location.search);
                        const allQueryParamsJson = {};
                        for (const [key, value] of allQueryParams) {
                            allQueryParamsJson[key] = value;
                        }

                        const raw = JSON.stringify({
                            data: {
                                ...this.formData,
                            },
                            conversionApi: this.buildPayload(eventName),
                            metaPixelId: this.config.metaPixelId,
                            conversionApiToken: this.config.conversionApiToken,
                            params: allQueryParamsJson,
                        });

                        const requestOptions = {
                            method: "POST",
                            headers: myHeaders,
                            body: raw,
                            redirect: "follow",
                        };
                        console.log("Submitting conversion:", JSON.parse(raw));

                        return new Promise((resolve, error) => {
                            fetch(this.config.conversionEndpoint, requestOptions)
                                .then((response) => response.text())
                                .then((data) => {
                                    console.log(data);
                                    this.isLoading = false;
                                    resolve(data);
                                })
                                .catch((error) => {
                                    console.error("Error submitting form:", error);
                                    this.isLoading = false;
                                })
                                .finally(() => {
                                    this.isLoading = false;
                                });
                        });
                    },
                    validatePhoneNumber(phoneNumber) {
                        if (!phoneNumber) {
                            return Promise.resolve(false);
                        }
                        phoneNumber = this.transformPhoneNumber(phoneNumber);
                        if (!phoneNumber || !/^\d+$/.test(phoneNumber)) {
                            return Promise.resolve(false);
                        }
                        if (typeof Storage !== "undefined") {
                            const validatedPhone = localStorage.getItem(phoneNumber);
                            if (validatedPhone) {
                                return Promise.resolve(
                                    validatedPhone === "invalid" ? false : validatedPhone
                                );
                            }
                        }
                        return new Promise((resolve, error) => {
                            fetch(
                                `https://sg.marketingmaster.io/apis_sms/validate_phone/${phoneNumber}`
                            )
                                .then((response) => response.text())
                                .then((result) => {
                                    const data = JSON.parse(result);
                                    if (typeof Storage !== "undefined") {
                                        localStorage.setItem(
                                            phoneNumber,
                                            data.valid ? data.formatted : "invalid"
                                        );
                                    }
                                    resolve(data.valid ? data.formatted : false);
                                })
                                .catch((error) => console.error(error));
                        });
                    },
                    transformPhoneNumber(input) {
                        let digits = input.replace(/\D/g, "");
                        if (digits.startsWith("63")) {
                        } else if (digits.startsWith("0")) {
                            digits = "63" + digits.substring(1);
                        } else {
                            digits = "63" + digits;
                        }
                        return digits;
                    },
                    validateEmail(email) {
                        if (!email) {
                            return Promise.resolve(false);
                        }
                        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                        if (!emailRegex.test(email)) {
                            return Promise.resolve(false);
                        }
                        if (typeof Storage !== "undefined") {
                            const validatedEmail = localStorage.getItem(email);
                            if (validatedEmail) {
                                return Promise.resolve(
                                    validatedEmail === "invalid" ? false : email
                                );
                            }
                        }
                        return new Promise((resolve, error) => {
                            fetch(
                                `https://sg.marketingmaster.io/apis_sms/validate_email/${email}`
                            )
                                .then((response) => response.text())
                                .then((result) => {
                                    const data = JSON.parse(result);
                                    if (typeof Storage !== "undefined") {
                                        localStorage.setItem(
                                            email,
                                            data.valid ? email : "invalid"
                                        );
                                    }
                                    resolve(data.valid ? email : false);
                                })
                                .catch((error) => console.error(error));
                        });
                    },
                    async validateContactDetails() {
                        const loader = document.getElementById("loader");
                        loader.style.display = "flex";
                        const forValidationPromises = [
                            this.validatePhoneNumber(this.formData.phone),
                            this.validateEmail(this.formData.email),
                        ];
                        const [validatedPhone, validatedEmail] = await Promise.all(
                            forValidationPromises
                        );
                        if (!validatedPhone && this.config.requirePhone) {
                            this.isValidating = true;
                            this.isPhoneInvalid = true;
                            alert("Phone number is invalid. Please check the input.");
                            loader.style.display = "none";
                            return false;
                        }
                        if (!validatedEmail && this.config.requireEmail) {
                            this.isValidating = true;
                            this.isEmailInvalid = true;
                            loader.style.display = "none";
                            alert("Email is invalid. Please check the input.");
                            return false;
                        }
                        this.formData.phone = validatedPhone;
                        loader.style.display = "none";
                        return true;
                    },
                    // Updated OTP: Request OTP and show separate OTP screen with countdown
                    sendOTP() {
                        if (!this.agreeToTerms) {
                            alert("Please agree to the terms and conditions.");
                            return;
                        }
                        if (!this.formData.phone) {
                            alert("Phone number is required to send OTP.");
                            return;
                        }
                        this.isOTPLoading = true;

                        fetch(
                            this.config.apiHost +
                            "/cform_request_otp?phone_number=" +
                            this.formData.phone +
                            "&senderId=" +
                            this.config.senderId
                        )
                            .then((response) => response.json())
                            .then((data) => {
                                const { cache_key } = data;
                                this.otpCacheKey = cache_key;
                                this.otpSent = true;
                                this.showOTPScreen = true;
                                this.startOtpCountdown();
                                alert("OTP sent successfully. Please check your SMS.");
                                this.isOTPLoading = false;
                                return data;
                            })
                            .catch((error) => {
                                this.isOTPLoading = false;
                            })
                            .finally((data) => {
                                this.isOTPLoading = false;
                            });
                    },
                    // Updated OTP: Verify OTP using the digits entered
                    verifyOTP() {
                        const otp = this.otpDigits.join("");
                        if (otp.length !== 4) {
                            alert("Please enter a valid 4-digit OTP.");
                            return;
                        }
                        this.isOTPLoading = true;
                        fetch(
                            this.config.apiHost +
                            `/cform_verify_otp?cache_key=${this.otpCacheKey}&otp=${otp}`
                        )
                            .then((response) => response.json())
                            .then((data) => {
                                const { status, verification_token } = data;
                                if (!status) {
                                    alert("Invalid OTP. Please try again.");
                                    this.isOTPLoading = false;
                                    this.otpValidated = false;
                                    return;
                                }
                                this.otpValidationToken = verification_token;
                                this.otpValidated = true;
                                clearInterval(this.otpInterval);
                                alert("OTP validated successfully.");
                                this.finalizeSubmission();
                                this.isOTPLoading = false;
                                return data;
                            })
                            .catch((error) => {
                                this.isOTPLoading = false;
                            })
                            .finally((data) => {
                                this.isOTPLoading = false;
                            });
                    },
                    // New method to start a 5-minute countdown timer
                    startOtpCountdown() {
                        this.otpCountdown = 300;
                        if (this.otpInterval) {
                            clearInterval(this.otpInterval);
                        }
                        this.otpInterval = setInterval(() => {
                            if (this.otpCountdown > 0) {
                                this.otpCountdown--;
                            } else {
                                clearInterval(this.otpInterval);
                            }
                        }, 1000);
                    },
                    // OTP input event handlers (using a multi-input approach)
                    handleOtpKeydown(index, event) {
                        if (
                            !/^\d$/.test(event.key) &&
                            event.key !== "Backspace" &&
                            event.key !== "Delete" &&
                            event.key !== "Tab" &&
                            !event.metaKey
                        ) {
                            event.preventDefault();
                        }
                        if (event.key === "Backspace" || event.key === "Delete") {
                            if (index > 0) {
                                this.otpDigits[index] = "";
                                document.getElementById("otp" + (index - 1)).focus();
                            }
                        }
                    },
                    handleOtpInput(index, event) {
                        if (event.target.value && index < this.otpDigits.length - 1) {
                            document.getElementById("otp" + (index + 1)).focus();
                        }
                    },
                    handleOtpFocus(event) {
                        event.target.select();
                    },
                    handleOtpPaste(event) {
                        event.preventDefault();
                        const text = event.clipboardData.getData("text");
                        if (!/^\d{4}$/.test(text)) return;
                        this.otpDigits = text.split("");
                    },
                    initMeiliSearch(index = "baranggays") {
                        const client = new meilisearch.MeiliSearch({
                            host: "https://search.idrs.ph",
                            apiKey: "b78c1af715c42062845f4f7ad7707e9760c505b23d06f35786af6d0b4f967c9f"
                        });
                        return client.index(index);
                    },
                    getBarangays: debounce(function () {
                        if (this.formData.barangay && this.formData.barangay.length > 1) {
                            this.isBarangaySearchLoading = true;
                            this.showBarangayDropdown = true;
                            this.initMeiliSearch().search(this.formData.barangay).then((res) => {
                                this.barangays = res.hits;
                                this.isBarangaySearchLoading = false;
                                // Initialize or update Popper after results are loaded
                                this.$nextTick(() => {
                                    this.initPopper('barangay');
                                });
                            }).catch(err => {
                                console.error('Error searching barangays:', err);
                                this.isBarangaySearchLoading = false;
                            });
                        } else {
                            this.barangays = [];
                            this.showBarangayDropdown = false;
                            this.isBarangaySearchLoading = false;
                        }
                    }, 300),

                    getCities: debounce(function () {
                        if (this.formData.city && this.formData.city.length > 1) {
                            this.isCitySearchLoading = true;
                            this.showCityDropdown = true;
                            this.initMeiliSearch().search(this.formData.city, {
                                attributesToSearchOn: ['city_municipality', 'province', 'region']
                            }).then((res) => {
                                // Remove duplicates by city name
                                const uniqueCities = [];
                                const cityNames = new Set();

                                res.hits.forEach(hit => {
                                    if (!cityNames.has(hit.city_municipality)) {
                                        cityNames.add(hit.city_municipality);
                                        uniqueCities.push({
                                            name: hit.city_municipality,
                                            province: hit.province || hit.region
                                        });
                                    }
                                });

                                this.cities = uniqueCities;
                                this.isCitySearchLoading = false;
                                // Initialize or update Popper after results are loaded
                                this.$nextTick(() => {
                                    this.initPopper('city');
                                });
                            }).catch(err => {
                                console.error('Error searching cities:', err);
                                this.isCitySearchLoading = false;
                            });
                        } else {
                            this.cities = [];
                            this.showCityDropdown = false;
                            this.isCitySearchLoading = false;
                        }
                    }, 300),

                    getProvinces: debounce(function () {
                        if (this.formData.province && this.formData.province.length > 1) {
                            this.isProvinceSearchLoading = true;
                            this.showProvinceDropdown = true;
                            this.initMeiliSearch().search(this.formData.province, {
                                attributesToSearchOn: ['province', 'region']
                            }).then((res) => {
                                // Remove duplicates by province/region name
                                const uniqueProvinces = [];
                                const provinceNames = new Set();

                                res.hits.forEach(hit => {
                                    const provinceName = hit.province || hit.region;
                                    if (provinceName && !provinceNames.has(provinceName)) {
                                        provinceNames.add(provinceName);
                                        uniqueProvinces.push({
                                            name: provinceName
                                        });
                                    }
                                });

                                this.provinces = uniqueProvinces;
                                this.isProvinceSearchLoading = false;
                                // Initialize or update Popper after results are loaded
                                this.$nextTick(() => {
                                    this.initPopper('province');
                                });
                            }).catch(err => {
                                console.error('Error searching provinces:', err);
                                this.isProvinceSearchLoading = false;
                            });
                        } else {
                            this.provinces = [];
                            this.showProvinceDropdown = false;
                            this.isProvinceSearchLoading = false;
                        }
                    }, 300),
                    selectBarangay(barangay) {
                        this.formData.barangay = barangay.brgy;
                        this.formData.city = barangay.city_municipality;
                        this.formData.province = barangay.province || barangay.region;
                        this.showBarangayDropdown = false;
                        const event = new CustomEvent('barangay-selected', {
                            detail: { barangay: barangay }
                        });
                        document.dispatchEvent(event);
                    },
                    selectCity(city) {
                        this.formData.city = city.name;
                        // If the city has province info, update that field too
                        if (city.province) {
                            this.formData.province = city.province;
                        }
                        this.showCityDropdown = false;
                        const event = new CustomEvent('city-selected', {
                            detail: { city: city }
                        });
                        document.dispatchEvent(event);
                    },
                    selectProvince(province) {
                        this.formData.province = province.name;
                        this.showProvinceDropdown = false;
                        const event = new CustomEvent('province-selected', {
                            detail: { province: province }
                        });
                        document.dispatchEvent(event);
                    },
                    initPopper(type = 'barangay') {
                        let input, dropdown, popperInstanceVar;

                        // Determine which elements to use based on type
                        switch (type) {
                            case 'city':
                                input = document.getElementById('city');
                                dropdown = this.$refs.cityDropdown;
                                popperInstanceVar = 'popperCityInstance';
                                break;
                            case 'province':
                                input = document.getElementById('province');
                                dropdown = this.$refs.provinceDropdown;
                                popperInstanceVar = 'popperProvinceInstance';
                                break;
                            default: // barangay
                                input = document.getElementById('barangay');
                                dropdown = this.$refs.barangayDropdown;
                                popperInstanceVar = 'popperInstance';
                                break;
                        }

                        // Make sure both elements exist
                        if (!input || !dropdown || !window.Popper) return;

                        // Create or update the Popper instance
                        if (this[popperInstanceVar]) {
                            this[popperInstanceVar].update();
                        } else {
                            this[popperInstanceVar] = Popper.createPopper(input, dropdown, {
                                placement: 'bottom-start',
                                modifiers: [
                                    {
                                        name: 'offset',
                                        options: {
                                            offset: [0, 4],
                                        },
                                    },
                                    {
                                        name: 'preventOverflow',
                                        options: {
                                            boundary: document.body,
                                        },
                                    }
                                ],
                            });
                        }
                    },
                    setupClickOutside() {
                        // Add click outside listener to close all dropdowns
                        document.addEventListener('click', (event) => {
                            // Handle barangay dropdown
                            const barangayInput = document.getElementById('barangay');
                            const barangayDropdown = this.$refs.barangayDropdown;

                            if (barangayInput && barangayDropdown &&
                                !barangayInput.contains(event.target) &&
                                !barangayDropdown.contains(event.target)) {
                                this.showBarangayDropdown = false;
                            }

                            // Handle city dropdown
                            const cityInput = document.getElementById('city');
                            const cityDropdown = this.$refs.cityDropdown;

                            if (cityInput && cityDropdown &&
                                !cityInput.contains(event.target) &&
                                !cityDropdown.contains(event.target)) {
                                this.showCityDropdown = false;
                            }

                            // Handle province dropdown
                            const provinceInput = document.getElementById('province');
                            const provinceDropdown = this.$refs.provinceDropdown;

                            if (provinceInput && provinceDropdown &&
                                !provinceInput.contains(event.target) &&
                                !provinceDropdown.contains(event.target)) {
                                this.showProvinceDropdown = false;
                            }
                        });
                    },
                    mounted() {
                        this.globalEventId = Math.random().toString(36).substring(2, 15);
                        if (localStorage.getItem("formData")) {
                            this.formData = JSON.parse(localStorage.getItem("formData"));
                        }

                        // Setup click outside handler for the barangay dropdown
                        this.setupClickOutside();
                        if (window.location.search.includes("submission_status=success")) {
                            this.submitStatus = "success";
                            setTimeout(async () => {
                                await this.reportConversion("Purchase");
                            }, 1000);
                        } else if (
                            window.location.search.includes("submission_status=failed")
                        ) {
                            this.submitStatus = "failed";
                        }
                        const loader = document.getElementById("loader");
                        const app = document.getElementById("app");
                        app.style.display = "flex";

                        const placeholderApp = document.getElementById("placeholder-app");
                        placeholderApp.style.display = "none";

                        loader.style.display = "none";
                        fbq("init", this.config.metaPixelId);
                        fbq("track", "PageView");
                        this.meiliSearch = this.initMeiliSearch();
                    },
                }).mount("#app");
            });

        </script>
        <div id="loader" class="fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center z-50" style="display: none;">
            <svg class="animate-spin -ml-1 mr-3 h-10 w-10 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                </path>
            </svg>
        </div>
        <div id="app" style="display:none" class="w-full flex items-center justify-center" v-scope @vue:mounted="mounted">
            <div v-if="submitStatus === 'failed'" class="flex items-center justify-center w-full h-full max-w-md">
                <div class="bg-white p-6 rounded-lg shadow-md flex flex-col items-center justify-center">
                    <div class="w-full flex items-center justify-center relative mb-6">
                        <img src="./assets/mx3coffeefront_400x.webp" alt="MX3 Coffee Mix" class="logo mx-auto w-16 h-16 mb-4 rounded-full absolute -top-12 bg-white p-1">
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 text-center mb-2 capitalize">Complete Your MX3 Coffee Mix Order</h2>
                    <p class="text-gray-600 text-center mb-6 text-xs">Start your day right with MX3 Coffee Mix—an easy-to-enjoy, low-acid coffee packed with beneficial nutrients like Vitamin C, Calcium, and Mangosteen.</p>
                    <div class="p-5 text-center w-16 h-16 rounded-full flex items-center justify-center text-white bg-red-700">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512" fill="#fff">
                            <path d="M376.6 84.5c11.3-13.6 9.5-33.8-4.1-45.1s-33.8-9.5-45.1 4.1L192 206 56.6 43.5C45.3 29.9 25.1 28.1 11.5 39.4S-3.9 70.9 7.4 84.5L150.3 256 7.4 427.5c-11.3 13.6-9.5 33.8 4.1 45.1s33.8 9.5 45.1-4.1L192 306 327.4 468.5c11.3 13.6 31.5 15.4 45.1 4.1s15.4-31.5 4.1-45.1L233.7 256 376.6 84.5z" />
                        </svg>
                    </div>
                    <h2 class="text-5xl font-bold text-gray-800 text-center mb-4 text-red-700">Submission Failed</h2>
                    <p class="text-gray-600 text-center mb-6">Your submission has failed. Please try again.</p>
                </div>
            </div>
            <div v-else-if="submitStatus === 'success'" class="flex items-center justify-center w-full h-full max-w-md">
                <div class="bg-white p-6 rounded-lg shadow-md flex flex-col items-center justify-center">
                    <div class="w-full flex items-center justify-center relative mb-6">
                        <img src="./assets/mx3coffeefront_400x.webp" alt="MX3 Coffee Mix" class="logo mx-auto w-16 h-16 mb-4 rounded-full absolute -top-12 bg-white p-1">
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 text-center mb-2 capitalize">Complete Your MX3 Coffee Mix Order</h2>
                    <p class="text-gray-600 text-center mb-6 text-xs">Start your day right with MX3 Coffee Mix—an easy-to-enjoy, low-acid coffee packed with beneficial nutrients like Vitamin C, Calcium, and Mangosteen.</p>
                    <div class="p-2 text-center w-16 h-16 rounded-full flex items-center justify-center text-white bg-green-700">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" stroke="#fff" fill="#fff">
                            <path d="M438.6 105.4c12.5 12.5 12.5 32.8 0 45.3l-256 256c-12.5 12.5-32.8 12.5-45.3 0l-128-128c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0L160 338.7 393.4 105.4c12.5-12.5 32.8-12.5 45.3 0z" />
                        </svg>
                    </div>
                    <h2 class="text-5xl font-bold text-gray-800 text-center mb-4 text-green-700">Submission Successful</h2>
                    <p class="text-gray-600 text-center mb-6">Thank you for your submission. You will receive an email confirmation shortly.</p>
                </div>
            </div>
            <!-- Form Container -->
            <div v-else-if="!isConfirmationVisible" class="w-full grid grid-cols-2 max-w-md rounded-lg shadow-md mb-16 min-h-[90vh]">
                <div class="col-span-full bg-white p-6">
                    <div class="w-full flex items-center justify-center relative mb-6">
                        <img src="./assets/mx3coffeefront_400x.webp" alt="MX3 Coffee Mix" class="logo mx-auto w-16 h-16 mb-4 rounded-full absolute -top-12 bg-white p-1">
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 text-center mb-2 capitalize">Complete Your MX3 Coffee Mix Order</h2>
                    <p class="text-gray-600 text-center mb-6 text-xs">Start your day right with MX3 Coffee Mix—an easy-to-enjoy, low-acid coffee packed with beneficial nutrients like Vitamin C, Calcium, and Mangosteen.</p>
                    <div class="w-full border-t border-gray-300 my-5"></div>
                    <form id="leadForm" class="grid grid-cols-2 gap-4">
                        <div class="col-span-1">
                            <label :class="isValidating && !formData.firstName ? 'text-red-500': ''" for="firstName" class="block text-sm font-medium text-gray-700">First Name <span class="text-xs italic text-gray-400">(Required)</span></label>
                            <input required @input="isValidating=false" :class="isValidating && !formData.firstName ? 'ring-2 ring-red-500': ''" v-model="formData.firstName" type="text" id="firstName" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md" autocomplete="given-name">
                        </div>
                        <div class="col-span-1">
                            <label :class="isValidating && !formData.lastName ? 'text-red-500': ''" for="lastName" class="block text-sm font-medium text-gray-700">Last Name <span class="text-xs italic text-gray-400">(Required)</span></label>
                            <input required @input="isValidating=false" :class="isValidating && !formData.lastName ? 'ring-2 ring-red-500': ''" v-model="formData.lastName" type="text" id="lastName" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md" autocomplete="family-name">
                        </div>
                        <div class="col-span-full">
                            <label :class="isValidating && !formData.phone && config.requirePhone ? 'text-red-500': ''" for="phone" class="block text-sm font-medium text-gray-700">Phone Number <span v-if="config.requirePhone" class="text-xs italic text-gray-400">(Required)</span></label>
                            <input :required="config.requirePhone" @input="isValidating=false,isPhoneInvalid=false" :class="isValidating && (!formData.phone || isPhoneInvalid) && config.requirePhone ? 'ring-2 ring-red-500': ''" placeholder="E.g. 09473212211" v-model="formData.phone" type="text" id="phone" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md" autocomplete="tel">
                            <span class="text-xs italic text-gray-400">Example: 09172221111</span>
                        </div>
                        <div class="col-span-full">
                            <label :class="isValidating && !formData.email && config.requireEmail ? 'text-red-500': ''" for="email" class="block text-sm font-medium text-gray-700">Email <span v-if="config.requireEmail" class="text-xs italic text-gray-400">(Required)</span></label>
                            <input :required="config.requireEmail" @input="isValidating=false,isEmailInvalid=false" :class="isValidating && (!formData.email || isEmailInvalid) && config.requireEmail ? 'ring-2 ring-red-500': ''" placeholder="E.g. john@gmail.com" v-model="formData.email" type="email" id="email" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md" autocomplete="email">
                            <span class="text-xs italic text-gray-400">Example: john@gmail.com</span>
                        </div>
                        <div class="col-span-full">
                            <label :class="isValidating && !formData.streetAddress ? 'text-red-500': ''" for="streetAddress" class="block text-sm font-medium text-gray-700">Street Address <span class="text-xs italic text-gray-400">(Required)</span></label>
                            <input required @input="isValidating=false" :class="isValidating && !formData.streetAddress ? 'ring-2 ring-red-500': ''" v-model="formData.streetAddress" type="text" id="streetAddress" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md" autocomplete="street-address">
                        </div>

                        <!-- Barangay Search Field -->
                        <div class="col-span-full">
                            <label :class="isValidating && !formData.barangay ? 'text-red-500': ''" for="barangay" class="block text-sm font-medium text-gray-700">Barangay <span class="text-xs italic text-gray-400">(Required)</span></label>
                            <div class="relative w-full">
                                <input required @input="getBarangays(), isValidating=false" @focus="showBarangayDropdown = true" :class="isValidating && !formData.barangay ? 'ring-2 ring-red-500': ''" v-model="formData.barangay" type="text" id="barangay" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md" autocomplete="address-level2" placeholder="Search for your barangay">
                                <!-- Loading indicator positioned inside input at the right -->
                                <div v-if="isBarangaySearchLoading" class="absolute right-3 top-1/2 transform -translate-y-1/2">
                                    <div class="w-5 h-5 border-2 border-gray-300 border-t-[#e63b60] rounded-full animate-spin"></div>
                                </div>

                                <!-- Results dropdown -->
                                <div v-show="showBarangayDropdown && (barangays.length > 0 || isBarangaySearchLoading)" ref="barangayDropdown" class="absolute z-20 w-full mt-1 bg-white rounded-md shadow-lg overflow-hidden">
                                    <!-- Loading state when no results yet -->
                                    <div v-if="isBarangaySearchLoading && barangays.length === 0" class="p-4 text-center">
                                        <div class="inline-block w-6 h-6 border-2 border-gray-300 border-t-[#e63b60] rounded-full animate-spin mb-2"></div>
                                        <p class="text-sm text-gray-600">Searching...</p>
                                    </div>

                                    <!-- Results list -->
                                    <div v-if="barangays.length > 0" class="divide-y divide-gray-100 list-none m-0 p-0 max-h-60 overflow-y-auto">
                                        <div v-for="(barangay, index) in barangays" :key="index" @click="selectBarangay(barangay)" class="cursor-pointer hover:bg-gradient-to-r hover:from-[#e63b6010] hover:to-[#ff6b4d10] transition-colors duration-150 p-2">
                                            <div class="text-sm font-medium text-gray-800">{{ [barangay.brgy, barangay.city_municipality, barangay.province, barangay.region].filter(Boolean).join(", ") }}</div>
                                        </div>
                                    </div>

                                    <!-- No results message -->
                                    <div v-if="!isBarangaySearchLoading && formData.barangay && formData.barangay.length > 1 && barangays.length === 0" class="p-4 text-center">
                                        <p class="text-sm text-gray-600">No barangays found</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- City Search Field -->
                        <div class="col-span-full">
                            <label :class="isValidating && !formData.city ? 'text-red-500': ''" for="city" class="block text-sm font-medium text-gray-700">City <span class="text-xs italic text-gray-400">(Required)</span></label>
                            <div class="relative w-full">
                                <input required @input="getCities(), isValidating=false" @focus="showCityDropdown = true" :class="isValidating && !formData.city ? 'ring-2 ring-red-500': ''" v-model="formData.city" type="text" id="city" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md" autocomplete="address-level2" placeholder="Search for your city">
                                <!-- Loading indicator positioned inside input at the right -->
                                <div v-if="isCitySearchLoading" class="absolute right-3 top-1/2 transform -translate-y-1/2">
                                    <div class="w-5 h-5 border-2 border-gray-300 border-t-[#e63b60] rounded-full animate-spin"></div>
                                </div>

                                <!-- Results dropdown -->
                                <div v-show="showCityDropdown && (cities.length > 0 || isCitySearchLoading)" ref="cityDropdown" class="absolute z-20 w-full mt-1 bg-white rounded-md shadow-lg overflow-hidden">
                                    <!-- Loading state when no results yet -->
                                    <div v-if="isCitySearchLoading && cities.length === 0" class="p-4 text-center">
                                        <div class="inline-block w-6 h-6 border-2 border-gray-300 border-t-[#e63b60] rounded-full animate-spin mb-2"></div>
                                        <p class="text-sm text-gray-600">Searching...</p>
                                    </div>

                                    <!-- Results list -->
                                    <div v-if="cities.length > 0" class="divide-y divide-gray-100 list-none m-0 p-0 max-h-60 overflow-y-auto">
                                        <div v-for="(city, index) in cities" :key="index" @click="selectCity(city)" class="cursor-pointer hover:bg-gradient-to-r hover:from-[#e63b6010] hover:to-[#ff6b4d10] transition-colors duration-150 p-2">
                                            <div class="text-sm font-medium text-gray-800">{{ [city.name, city.province].filter(Boolean).join(", ") }}</div>
                                        </div>
                                    </div>

                                    <!-- No results message -->
                                    <div v-if="!isCitySearchLoading && formData.city && formData.city.length > 1 && cities.length === 0" class="p-4 text-center">
                                        <p class="text-sm text-gray-600">No cities found</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Province Search Field -->
                        <div class="col-span-full">
                            <label :class="isValidating && !formData.province ? 'text-red-500': ''" for="province" class="block text-sm font-medium text-gray-700">Province <span class="text-xs italic text-gray-400">(Required)</span></label>
                            <div class="relative w-full">
                                <input required @input="getProvinces(), isValidating=false" @focus="showProvinceDropdown = true" :class="isValidating && !formData.province ? 'ring-2 ring-red-500': ''" v-model="formData.province" type="text" id="province" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md" autocomplete="address-level1" placeholder="Search for your province">
                                <!-- Loading indicator positioned inside input at the right -->
                                <div v-if="isProvinceSearchLoading" class="absolute right-3 top-1/2 transform -translate-y-1/2">
                                    <div class="w-5 h-5 border-2 border-gray-300 border-t-[#e63b60] rounded-full animate-spin"></div>
                                </div>

                                <!-- Results dropdown -->
                                <div v-show="showProvinceDropdown && (provinces.length > 0 || isProvinceSearchLoading)" ref="provinceDropdown" class="absolute z-20 w-full mt-1 bg-white rounded-md shadow-lg overflow-hidden">
                                    <!-- Loading state when no results yet -->
                                    <div v-if="isProvinceSearchLoading && provinces.length === 0" class="p-4 text-center">
                                        <div class="inline-block w-6 h-6 border-2 border-gray-300 border-t-[#e63b60] rounded-full animate-spin mb-2"></div>
                                        <p class="text-sm text-gray-600">Searching...</p>
                                    </div>

                                    <!-- Results list -->
                                    <div v-if="provinces.length > 0" class="divide-y divide-gray-100 list-none m-0 p-0 max-h-60 overflow-y-auto">
                                        <div v-for="(province, index) in provinces" :key="index" @click="selectProvince(province)" class="cursor-pointer hover:bg-gradient-to-r hover:from-[#e63b6010] hover:to-[#ff6b4d10] transition-colors duration-150 p-2">
                                            <div class="text-sm font-medium text-gray-800">{{ province.name }}</div>
                                        </div>
                                    </div>

                                    <!-- No results message -->
                                    <div v-if="!isProvinceSearchLoading && formData.province && formData.province.length > 1 && provinces.length === 0" class="p-4 text-center">
                                        <p class="text-sm text-gray-600">No provinces found</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div v-for="field in formConfig" :key="field.id" class="mb-4 col-span-full">
                            <label :for="field.id" class="block text-sm font-medium text-gray-700" :class="isValidating && !formData[field.id] && field.required ? 'text-red-500': ''">
                                {{ field.label }}
                                <span v-if="field.required" class="text-xs italic text-red-500"> *</span>
                            </label>
                            <p v-if="field.description" class="text-xs text-gray-600 italic">{{ field.description }}</p>

                            <!-- Standard input types: text, email, password, number, date, time, file -->
                            <template v-if="['text','email','password','number','date','time','color'].includes(field.type)">
                                <input @input="isValidating=false" :class="isValidating && !formData[field.id] && field.required ? 'ring-2 ring-red-500': ''" :id="field.id" :type="field.type" v-model="formData[field.id]" :placeholder="field.placeholder" :required="field.required" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md" />
                            </template>

                            <!-- Textarea -->
                            <template v-else-if="field.type === 'textarea'">
                                <textarea @input="isValidating=false" :class="isValidating && !formData[field.id] && field.required ? 'ring-2 ring-red-500': ''" :id="field.id" v-model="formData[field.id]" :placeholder="field.placeholder" :required="field.required" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md"></textarea>
                            </template>

                            <!-- Select Dropdown -->
                            <template v-else-if="field.type === 'select'">
                                <select @input="isValidating=false" :class="isValidating && !formData[field.id] && field.required ? 'ring-2 ring-red-500': ''" :id="field.id" v-model="formData[field.id]" :required="field.required" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md">
                                    <option value="" disabled selected>Select an option</option>
                                    <option v-for="option in field.options" :key="option.value" :value="option.value">
                                        {{ option.label }}
                                    </option>
                                </select>
                            </template>

                            <!-- Radio Buttons -->
                            <template v-else-if="field.type === 'radio'">
                                <div class="mt-1">
                                    <label v-for="option in field.options" :key="option.value" class="inline-flex items-center mr-4" :class="isValidating && !formData[field.id] && field.required ? 'ring-2 ring-red-500': ''">
                                        <input @input="isValidating=false" type="radio" :name="field.id" :value="option.value" v-model="formData[field.id]" :required="field.required" class="form-radio" />
                                        <span class="ml-2">{{ option.label }}</span>
                                    </label>
                                </div>
                            </template>

                            <!-- Checkboxes -->
                            <template v-else-if="field.type === 'checkbox'">
                                <div class="mt-1" :class="isValidating && !formData[field.id] && field.required ? 'ring-2 ring-red-500': ''">
                                    <!-- Multiple checkbox options -->
                                    <template v-if="field.options">
                                        <label v-for="option in field.options" :key="option.value" class="inline-flex items-center mr-4">
                                            <input @input="isValidating=false" type="checkbox" :value="option.value" v-model="formData[field.id]" class="form-checkbox" />
                                            <span class="ml-2">{{ option.label }}</span>
                                        </label>
                                    </template>
                                    <!-- Single checkbox (boolean) -->
                                    <template v-else>
                                        <input @input="isValidating=false" type="checkbox" :id="field.id" v-model="formData[field.id]" :required="field.required" class="form-checkbox" />
                                    </template>
                                </div>
                            </template>

                            <!-- Fallback: render as a standard input -->
                            <template v-else>
                                <input @input="isValidating=false" :class="isValidating && !formData[field.id] && field.required ? 'ring-2 ring-red-500': ''" :id="field.id" :type="field.type" v-model="formData[field.id]" :placeholder="field.placeholder" :required="field.required" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md" />
                            </template>
                        </div>
                    </form>
                    <!-- Fixed Submit Button -->
                    <div @click="submitForm" class="fixed md:relative bottom-0 w-full py-4 px-6 left-0 right-0 flex items-center justify-center">
                        <button submit type="button" id="submitButton" class="w-full md:max-w-sm space-x-2 text-white flex items-center justify-center text-lg py-3 px-6 rounded-md bg-gradient-to-r from-[#e63b60] to-[#ff6b4d] hover:from-[#e63b60] hover:to-[#ff5a3a] focus:outline-none focus:ring-4 focus:ring-pink-500">
                            <span>Place Your Order</span>
                            <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
            <!-- Confirmation Container with OTP Integration -->
            <div v-else class="w-full space-y-5">
                <!-- Confirmation Screen: Displays user details and a "Send OTP" button -->
                <div v-if="!showOTPScreen" class="w-full space-y-5">
                    <div class="w-full bg-white rounded-lg shadow-md p-6 max-w-md mx-auto">
                        <div class="w-full flex items-center justify-center relative mb-6">
                            <img src="./assets/mx3coffeefront_400x.webp" alt="MX3 Coffee Mix" class="logo mx-auto w-16 h-16 mb-4 rounded-full absolute -top-12 bg-white p-1">
                        </div>
                        <h2 class="text-2xl font-bold text-gray-800 text-center mb-2 capitalize">Complete Your MX3 Coffee Mix Order</h2>
                        <p class="text-gray-600 text-center mb-6 text-xs">Start your day right with MX3 Coffee Mix—an easy-to-enjoy, low-acid coffee packed with beneficial nutrients like Vitamin C, Calcium, and Mangosteen.</p>
                        <h2 class="text-2xl font-bold text-center mb-4">Confirm Your Details</h2>
                        <div class="w-full border-t border-gray-300 my-5"></div>
                        <ul class="space-y-2">
                            <li><strong>First Name:</strong> {{ formData.firstName }}</li>
                            <li><strong>Last Name:</strong> {{ formData.lastName }}</li>
                            <li><strong>Phone Number:</strong> {{ formData.phone }}</li>
                            <li><strong>Email:</strong> {{ formData.email }}</li>
                            <!-- Other fields here -->
                            <li v-for="field of Object.keys(formData).filter(key => formConfig.some(f => f.id === key) && key !== 'firstName' && key !== 'lastName' && key !== 'phone' && key !== 'email')" class="capitalize">
                                <strong>{{ formConfig.find(f => f.id === field)?.label || "" }}:</strong> {{ formData[field] }}
                            </li>
                        </ul>
                    </div>
                    <div class="w-full bg-white rounded-lg shadow-md p-6 max-w-md mx-auto">
                        <div class="mt-6 flex items-center justify-center space-x-2">
                            <button @click="isConfirmationVisible = false" class="bg-gray-300 py-2 px-4 rounded-md hover:bg-gray-400 flex items-center space-x-2">
                                <div class="h-4 w-4">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                                        <path d="M471.6 21.7c-21.9-21.9-57.3-21.9-79.2 0L362.3 51.7l97.9 97.9 30.1-30.1c21.9-21.9 21.9-57.3 0-79.2L471.6 21.7zm-299.2 220c-6.1 6.1-10.8 13.6-13.5 21.9l-29.6 88.8c-2.9 8.6-.6 18.1 5.8 24.6s15.9 8.7 24.6 5.8l88.8-29.6c8.2-2.7 15.7-7.4 21.9-13.5L437.7 172.3 339.7 74.3 172.4 241.7zM96 64C43 64 0 107 0 160L0 416c0 53 43 96 96 96l256 0c53 0 96-43 96-96l0-96c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 96c0 17.7-14.3 32-32 32L96 448c-17.7 0-32-14.3-32-32l0-256c0-17.7 14.3-32 32-32l96 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L96 64z" />
                                    </svg>
                                </div>
                                <span>Edit</span>
                            </button>
                            <button :disabled="isOTPLoading" @click="sendOTP" :class="
                                'w-full bg-indigo-600 py-2 px-4 rounded-md text-white text-2xl shadow-md flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed disabled:bg-gray-400'
                                +
                                (!agreeToTerms ? 'opacity-50 cursor-not-allowed bg-gray-400 hover:bg-gray-400' : 'hover:bg-indigo-700')
                            ">
                                <span v-if="isOTPLoading">Sending OTP...</span>
                                <span v-else>Confirm Details</span>
                            </button>
                        </div>
                        <div class="flex items-start justify-start mt-4 space-x-3">
                            <div class="">
                                <input type="checkbox" id="terms" name="terms" value="terms" required :class="!agreeToTerms ? 'form-checkbox rounded-md ring-2 ring-red-500 rounded-md p-0' : 'form-checkbox'" v-model="agreeToTerms">
                            </div>
                            <p class="text-[9px] text-gray-600">
                                I hereby certify that the information is true and given voluntarily. click this link for more information
                                The parties agree to comply with, and have adequate measures in place to ensure that its directors, officers, employees, and Representatives comply at all times with: (a) the provisions and obligations contained in Republic Act No. 10173 or the “Data Privacy Act of the Philippines” and its implementing rules and regulations, and (b) other applicable data privacy laws and regulations, as may be promulgated and/or amended from time to time. By agreeing to execute and enter into this Agreement, the parties agree that any information exchanged between them may be collected, processed, shared and used but only for purposes relevant to the Transaction. Each of the parties agrees to hold the other free and harmless from any costs or liability arising from its failure to comply with the requirements of the Data Privacy Act of the Philippines. <a class="text-blue-500 underline" href="https://drive.google.com/file/d/1fpTgh_FdxBLubJW-PCl5yOJrFkJ2D4Fs/view" target="_blank">(UNC Data Privacy Consent)</a>)
                            </p>
                        </div>
                    </div>
                </div>
                <!-- OTP Screen: Separate display for entering OTP and showing the countdown timer -->
                <div v-if="showOTPScreen" class="w-full bg-white rounded-lg shadow-md p-6 max-w-md mx-auto">
                    <div class="w-full flex items-center justify-center relative mb-6">
                        <img src="./assets/mx3coffeefront_400x.webp" alt="MX3 Coffee Mix" class="logo mx-auto w-16 h-16 mb-4 rounded-full absolute -top-12 bg-white p-1">
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 text-center mb-2 capitalize">Complete Your MX3 Coffee Mix Order</h2>
                    <p class="text-gray-600 text-center mb-6 text-xs">Start your day right with MX3 Coffee Mix—an easy-to-enjoy, low-acid coffee packed with beneficial nutrients like Vitamin C, Calcium, and Mangosteen.</p>
                    <div class="w-full border-t border-gray-300 my-5"></div>
                    <h2 class="text-2xl font-bold text-center mb-4">Enter OTP</h2>
                    <p class="text-gray-600 text-center mb-6">Please enter the 4-digit OTP sent to your phone number {{formData.phone}}.</p>
                    <div class="flex items-center justify-center gap-3">
                        <input v-for="(digit, index) in otpDigits" :key="index" type="text" :id="'otp'+index" maxlength="1" class="w-14 h-14 text-center text-2xl font-extrabold text-slate-900 bg-slate-100 border border-transparent hover:border-slate-200 appearance-none rounded p-4 outline-none focus:bg-white focus:border-indigo-400 focus:ring-2 focus:ring-indigo-100" v-model="otpDigits[index]" @input="handleOtpInput(index, $event)" @keydown="handleOtpKeydown(index, $event)" @focus="handleOtpFocus($event)" @paste="handleOtpPaste($event)" />
                    </div>
                    <span v-if="otpError" class="text-red-500 text-sm">{{ otpError }}</span>
                    <div class="mt-4 text-center">
                        <span class="text-lg font-bold">
                            {{ Math.floor(otpCountdown / 60) }}:{{ (otpCountdown % 60).toString().padStart(2, '0') }}
                        </span>
                        <p class="text-xs text-gray-600">OTP expires in 5 minutes</p>
                    </div>
                    <div class="mt-6 flex flex-col space-y-2">
                        <button :disabled="isOTPLoading" @click="verifyOTP" class="bg-indigo-600 py-2 px-4 rounded-md text-white hover:bg-indigo-700 text-2xl shadow-md flex items-center justify-center">
                            <span v-if="isOTPLoading">Verifying OTP...</span>
                            <span v-else>Verify OTP & Submit</span>
                        </button>
                        <div class="text-sm text-slate-500">Didn't receive code?
                            <a @click="sendOTP" class="font-medium text-indigo-500 hover:text-indigo-600 cursor-pointer">Resend</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="placeholder-app" class="w-full flex items-center justify-center">
            <!-- Form Container -->
            <div class="w-full grid grid-cols-2 max-w-md rounded-lg shadow-md mb-16 min-h-[90vh]">
                <div class="col-span-full bg-white p-6">
                    <div class="w-full flex items-center justify-center relative mb-6">
                        <img src="./assets/mx3coffeefront_400x.webp" alt="MX3 Coffee Mix" class="logo mx-auto w-16 h-16 mb-4 rounded-full absolute -top-12 bg-white p-1">
                    </div>
                    <h2 class="text-2xl font-bold text-gray-800 text-center mb-2 capitalize">Complete Your MX3 Coffee Mix Order</h2>
                    <p class="text-gray-600 text-center mb-6 text-xs">Start your day right with MX3 Coffee Mix—an easy-to-enjoy, low-acid coffee packed with beneficial nutrients like Vitamin C, Calcium, and Mangosteen.</p>
                    <div class="w-full border-t border-gray-300 my-5"></div>
                    <form id="leadForm" class="grid grid-cols-2 gap-4">
                        <div class="col-span-1">
                            <label for="firstName" class="block text-sm font-medium text-gray-700">First Name <span class="text-xs italic text-gray-400">(Required)</span></label>
                            <input required type="text" id="firstName" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md" autocomplete="given-name">
                        </div>
                        <div class="col-span-1">
                            <label class="block text-sm font-medium text-gray-700">Last Name <span class="text-xs italic text-gray-400">(Required)</span></label>
                            <input required type="text" id="lastName" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md" autocomplete="family-name">
                        </div>
                        <div class="col-span-full">
                            <label for="phone" class="block text-sm font-medium text-gray-700">Phone Number <span class="text-xs italic text-gray-400">(Required)</span></label>
                            <input placeholder="E.g. 09473212211" type="text" id="phone" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md" autocomplete="tel">
                            <span class="text-xs italic text-gray-400">Example: 09172221111</span>
                        </div>
                        <div class="col-span-full">
                            <label for="email" class="block text-sm font-medium text-gray-700">Email <span class="text-xs italic text-gray-400">(Required)</span></label>
                            <input placeholder="E.g. john@gmail.com" type="email" id="email" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md" autocomplete="email">
                            <span class="text-xs italic text-gray-400">Example: john@gmail.com</span>
                        </div>
                    </form>
                    <!-- Fixed Submit Button -->
                    <div class="fixed md:relative bottom-0 w-full py-4 px-6 left-0 right-0 flex items-center justify-center">
                        <button submit type="button" id="submitButton" class="w-full md:max-w-sm space-x-2 text-white flex items-center justify-center text-lg py-3 px-6 rounded-md bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-500">
                            <span>Continue</span>
                            <div class="h-4 w-4 text-white">
                                <svg fill="#fff" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
                                    <path d="M438.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-160-160c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L338.8 224 32 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l306.7 0L233.4 393.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l160-160z" />
                                </svg>
                            </div>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </body>

</html>
